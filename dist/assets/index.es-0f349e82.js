import it from"./index.es-389e4cca.js";function st(i,e){var t={};for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&e.indexOf(r)<0&&(t[r]=i[r]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(i);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(i,r[s])&&(t[r[s]]=i[r[s]]);return t}function R(i,e,t,r){function s(u){return u instanceof t?u:new t(function(a){a(u)})}return new(t||(t=Promise))(function(u,a){function d(S){try{M(r.next(S))}catch(P){a(P)}}function m(S){try{M(r.throw(S))}catch(P){a(P)}}function M(S){S.done?u(S.value):s(S.value).then(d,m)}M((r=r.apply(i,e||[])).next())})}const Re=()=>{for(var i=[],e=[],t=typeof Uint8Array<"u"?Uint8Array:Array,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,u=r.length;s<u;++s)i[s]=r[s],e[r.charCodeAt(s)]=s;e["-".charCodeAt(0)]=62,e["_".charCodeAt(0)]=63;function a(_){var g=_.length;if(g%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var T=_.indexOf("=");T===-1&&(T=g);var O=T===g?0:4-T%4;return[T,O]}function d(_,g,T){return(g+T)*3/4-T}function m(_){var g,T=a(_),O=T[0],h=T[1],l=new t(d(_,O,h)),p=0,I=h>0?O-4:O,k;for(k=0;k<I;k+=4)g=e[_.charCodeAt(k)]<<18|e[_.charCodeAt(k+1)]<<12|e[_.charCodeAt(k+2)]<<6|e[_.charCodeAt(k+3)],l[p++]=g>>16&255,l[p++]=g>>8&255,l[p++]=g&255;return h===2&&(g=e[_.charCodeAt(k)]<<2|e[_.charCodeAt(k+1)]>>4,l[p++]=g&255),h===1&&(g=e[_.charCodeAt(k)]<<10|e[_.charCodeAt(k+1)]<<4|e[_.charCodeAt(k+2)]>>2,l[p++]=g>>8&255,l[p++]=g&255),l}function M(_){return i[_>>18&63]+i[_>>12&63]+i[_>>6&63]+i[_&63]}function S(_,g,T){for(var O,h=[],l=g;l<T;l+=3)O=(_[l]<<16&16711680)+(_[l+1]<<8&65280)+(_[l+2]&255),h.push(M(O));return h.join("")}function P(_){for(var g,T=_.length,O=T%3,h=[],l=16383,p=0,I=T-O;p<I;p+=l)h.push(S(_,p,p+l>I?I:p+l));return O===1?(g=_[T-1],h.push(i[g>>2]+i[g<<4&63]+"==")):O===2&&(g=(_[T-2]<<8)+_[T-1],h.push(i[g>>10]+i[g>>4&63]+i[g<<2&63]+"=")),h.join("")}return{toByteArray:m,fromByteArray:P}};function ot(i){let e=Fe(i);return new TextDecoder("utf-8",{fatal:!0}).decode(e)}function ut(i){return new TextDecoder("utf-8",{fatal:!0}).decode(i)}function Le(i){return new TextEncoder().encode(i)}function at(i){return We(Le(i))}function Fe(i){return new Uint8Array(Re().toByteArray(Be(i)))}function qe(i){return Re().fromByteArray(new Uint8Array(i))}function We(i){return De(qe(i))}function De(i){return i.replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}function Be(i){i=i.replace(/\-/g,"+").replace(/\_/g,"/");let e;return i.length%4==0?e=0:e=4-i.length%4,i.concat("=".repeat(e))}const J={b64UrlToString:ot,bufferToString:ut,stringToBuffer:Le,stringToB64Url:at,b64UrlToBuffer:Fe,bufferTob64:qe,bufferTob64Url:We,b64UrlEncode:De,b64UrlDecode:Be};class ft{get(e,t){if(!Object.getOwnPropertyNames(this).includes(e))throw new Error(`Field "${e}" is not a property of the Arweave Transaction class.`);return this[e]instanceof Uint8Array?t&&t.decode&&t.string?J.bufferToString(this[e]):t&&t.decode&&!t.string?this[e]:J.bufferTob64Url(this[e]):t&&t.decode==!0?t&&t.string?J.b64UrlToString(this[e]):J.b64UrlToBuffer(this[e]):this[e]}}class lt extends ft{constructor(e,t,r=!1){super(),this.name=e,this.value=t}}var Me=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},Te={};/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Se;function Ge(){if(Se)return Te;Se=1;var i;return function(e){(function(t){var r=typeof Me=="object"?Me:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),s=u(e);typeof r.Reflect>"u"?r.Reflect=e:s=u(r.Reflect,s),t(s);function u(a,d){return function(m,M){typeof a[m]!="function"&&Object.defineProperty(a,m,{configurable:!0,writable:!0,value:M}),d&&d(m,M)}}})(function(t){var r=Object.prototype.hasOwnProperty,s=typeof Symbol=="function",u=s&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",a=s&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",d=typeof Object.create=="function",m={__proto__:[]}instanceof Array,M=!d&&!m,S={create:d?function(){return ae(Object.create(null))}:m?function(){return ae({__proto__:null})}:function(){return ae({})},has:M?function(n,o){return r.call(n,o)}:function(n,o){return o in n},get:M?function(n,o){return r.call(n,o)?n[o]:void 0}:function(n,o){return n[o]}},P=Object.getPrototypeOf(Function),_=typeof process=="object"&&process.env&&process.env.REFLECT_METADATA_USE_MAP_POLYFILL==="true",g=!_&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:tt(),T=!_&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:rt(),O=!_&&typeof WeakMap=="function"?WeakMap:nt(),h=new O;function l(n,o,f,c){if(C(f)){if(!be(n))throw new TypeError;if(!Pe(o))throw new TypeError;return ie(n,o)}else{if(!be(n))throw new TypeError;if(!U(o))throw new TypeError;if(!U(c)&&!C(c)&&!z(c))throw new TypeError;return z(c)&&(c=void 0),f=q(f),se(n,o,f,c)}}t("decorate",l);function p(n,o){function f(c,v){if(!U(c))throw new TypeError;if(!C(v)&&!Qe(v))throw new TypeError;ye(n,o,c,v)}return f}t("metadata",p);function I(n,o,f,c){if(!U(f))throw new TypeError;return C(c)||(c=q(c)),ye(n,o,f,c)}t("defineMetadata",I);function k(n,o,f){if(!U(o))throw new TypeError;return C(f)||(f=q(f)),pe(n,o,f)}t("hasMetadata",k);function ee(n,o,f){if(!U(o))throw new TypeError;return C(f)||(f=q(f)),oe(n,o,f)}t("hasOwnMetadata",ee);function te(n,o,f){if(!U(o))throw new TypeError;return C(f)||(f=q(f)),_e(n,o,f)}t("getMetadata",te);function re(n,o,f){if(!U(o))throw new TypeError;return C(f)||(f=q(f)),ve(n,o,f)}t("getOwnMetadata",re);function ne(n,o){if(!U(n))throw new TypeError;return C(o)||(o=q(o)),me(n,o)}t("getMetadataKeys",ne);function x(n,o){if(!U(n))throw new TypeError;return C(o)||(o=q(o)),we(n,o)}t("getOwnMetadataKeys",x);function F(n,o,f){if(!U(o))throw new TypeError;C(f)||(f=q(f));var c=K(o,f,!1);if(C(c)||!c.delete(n))return!1;if(c.size>0)return!0;var v=h.get(o);return v.delete(f),v.size>0||h.delete(o),!0}t("deleteMetadata",F);function ie(n,o){for(var f=n.length-1;f>=0;--f){var c=n[f],v=c(o);if(!C(v)&&!z(v)){if(!Pe(v))throw new TypeError;o=v}}return o}function se(n,o,f,c){for(var v=n.length-1;v>=0;--v){var N=n[v],w=N(o,f,c);if(!C(w)&&!z(w)){if(!U(w))throw new TypeError;c=w}}return c}function K(n,o,f){var c=h.get(n);if(C(c)){if(!f)return;c=new g,h.set(n,c)}var v=c.get(o);if(C(v)){if(!f)return;v=new g,c.set(o,v)}return v}function pe(n,o,f){var c=oe(n,o,f);if(c)return!0;var v=ue(o);return z(v)?!1:pe(n,v,f)}function oe(n,o,f){var c=K(o,f,!1);return C(c)?!1:$e(c.has(n))}function _e(n,o,f){var c=oe(n,o,f);if(c)return ve(n,o,f);var v=ue(o);if(!z(v))return _e(n,v,f)}function ve(n,o,f){var c=K(o,f,!1);if(!C(c))return c.get(n)}function ye(n,o,f,c){var v=K(f,c,!0);v.set(n,o)}function me(n,o){var f=we(n,o),c=ue(n);if(c===null)return f;var v=me(c,o);if(v.length<=0)return f;if(f.length<=0)return v;for(var N=new T,w=[],b=0,y=f;b<y.length;b++){var A=y[b],E=N.has(A);E||(N.add(A),w.push(A))}for(var D=0,Ee=v;D<Ee.length;D++){var A=Ee[D],E=N.has(A);E||(N.add(A),w.push(A))}return w}function we(n,o){var f=[],c=K(n,o,!1);if(C(c))return f;for(var v=c.keys(),N=je(v),w=0;;){var b=Ze(N);if(!b)return f.length=w,f;var y=Xe(b);try{f[w]=y}catch(A){try{et(N)}finally{throw A}}w++}}function ge(n){if(n===null)return 1;switch(typeof n){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return n===null?1:6;default:return 6}}function C(n){return n===void 0}function z(n){return n===null}function ze(n){return typeof n=="symbol"}function U(n){return typeof n=="object"?n!==null:typeof n=="function"}function Ye(n,o){switch(ge(n)){case 0:return n;case 1:return n;case 2:return n;case 3:return n;case 4:return n;case 5:return n}var f=o===3?"string":o===5?"number":"default",c=Ae(n,u);if(c!==void 0){var v=c.call(n,f);if(U(v))throw new TypeError;return v}return Ke(n,f==="default"?"number":f)}function Ke(n,o){if(o==="string"){var f=n.toString;if(Y(f)){var c=f.call(n);if(!U(c))return c}var v=n.valueOf;if(Y(v)){var c=v.call(n);if(!U(c))return c}}else{var v=n.valueOf;if(Y(v)){var c=v.call(n);if(!U(c))return c}var N=n.toString;if(Y(N)){var c=N.call(n);if(!U(c))return c}}throw new TypeError}function $e(n){return!!n}function Je(n){return""+n}function q(n){var o=Ye(n,3);return ze(o)?o:Je(o)}function be(n){return Array.isArray?Array.isArray(n):n instanceof Object?n instanceof Array:Object.prototype.toString.call(n)==="[object Array]"}function Y(n){return typeof n=="function"}function Pe(n){return typeof n=="function"}function Qe(n){switch(ge(n)){case 3:return!0;case 4:return!0;default:return!1}}function Ae(n,o){var f=n[o];if(f!=null){if(!Y(f))throw new TypeError;return f}}function je(n){var o=Ae(n,a);if(!Y(o))throw new TypeError;var f=o.call(n);if(!U(f))throw new TypeError;return f}function Xe(n){return n.value}function Ze(n){var o=n.next();return o.done?!1:o}function et(n){var o=n.return;o&&o.call(n)}function ue(n){var o=Object.getPrototypeOf(n);if(typeof n!="function"||n===P||o!==P)return o;var f=n.prototype,c=f&&Object.getPrototypeOf(f);if(c==null||c===Object.prototype)return o;var v=c.constructor;return typeof v!="function"||v===n?o:v}function tt(){var n={},o=[],f=function(){function w(b,y,A){this._index=0,this._keys=b,this._values=y,this._selector=A}return w.prototype["@@iterator"]=function(){return this},w.prototype[a]=function(){return this},w.prototype.next=function(){var b=this._index;if(b>=0&&b<this._keys.length){var y=this._selector(this._keys[b],this._values[b]);return b+1>=this._keys.length?(this._index=-1,this._keys=o,this._values=o):this._index++,{value:y,done:!1}}return{value:void 0,done:!0}},w.prototype.throw=function(b){throw this._index>=0&&(this._index=-1,this._keys=o,this._values=o),b},w.prototype.return=function(b){return this._index>=0&&(this._index=-1,this._keys=o,this._values=o),{value:b,done:!0}},w}();return function(){function w(){this._keys=[],this._values=[],this._cacheKey=n,this._cacheIndex=-2}return Object.defineProperty(w.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),w.prototype.has=function(b){return this._find(b,!1)>=0},w.prototype.get=function(b){var y=this._find(b,!1);return y>=0?this._values[y]:void 0},w.prototype.set=function(b,y){var A=this._find(b,!0);return this._values[A]=y,this},w.prototype.delete=function(b){var y=this._find(b,!1);if(y>=0){for(var A=this._keys.length,E=y+1;E<A;E++)this._keys[E-1]=this._keys[E],this._values[E-1]=this._values[E];return this._keys.length--,this._values.length--,b===this._cacheKey&&(this._cacheKey=n,this._cacheIndex=-2),!0}return!1},w.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=n,this._cacheIndex=-2},w.prototype.keys=function(){return new f(this._keys,this._values,c)},w.prototype.values=function(){return new f(this._keys,this._values,v)},w.prototype.entries=function(){return new f(this._keys,this._values,N)},w.prototype["@@iterator"]=function(){return this.entries()},w.prototype[a]=function(){return this.entries()},w.prototype._find=function(b,y){return this._cacheKey!==b&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=b)),this._cacheIndex<0&&y&&(this._cacheIndex=this._keys.length,this._keys.push(b),this._values.push(void 0)),this._cacheIndex},w}();function c(w,b){return w}function v(w,b){return b}function N(w,b){return[w,b]}}function rt(){return function(){function n(){this._map=new g}return Object.defineProperty(n.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),n.prototype.has=function(o){return this._map.has(o)},n.prototype.add=function(o){return this._map.set(o,o),this},n.prototype.delete=function(o){return this._map.delete(o)},n.prototype.clear=function(){this._map.clear()},n.prototype.keys=function(){return this._map.keys()},n.prototype.values=function(){return this._map.values()},n.prototype.entries=function(){return this._map.entries()},n.prototype["@@iterator"]=function(){return this.keys()},n.prototype[a]=function(){return this.keys()},n}()}function nt(){var n=16,o=S.create(),f=c();return function(){function y(){this._key=c()}return y.prototype.has=function(A){var E=v(A,!1);return E!==void 0?S.has(E,this._key):!1},y.prototype.get=function(A){var E=v(A,!1);return E!==void 0?S.get(E,this._key):void 0},y.prototype.set=function(A,E){var D=v(A,!0);return D[this._key]=E,this},y.prototype.delete=function(A){var E=v(A,!1);return E!==void 0?delete E[this._key]:!1},y.prototype.clear=function(){this._key=c()},y}();function c(){var y;do y="@@WeakMap@@"+b();while(S.has(o,y));return o[y]=!0,y}function v(y,A){if(!r.call(y,f)){if(!A)return;Object.defineProperty(y,f,{value:S.create()})}return y[f]}function N(y,A){for(var E=0;E<A;++E)y[E]=Math.random()*255|0;return y}function w(y){return typeof Uint8Array=="function"?typeof crypto<"u"?crypto.getRandomValues(new Uint8Array(y)):typeof msCrypto<"u"?msCrypto.getRandomValues(new Uint8Array(y)):N(new Uint8Array(y),y):N(new Array(y),y)}function b(){var y=w(n);y[6]=y[6]&79|64,y[8]=y[8]&191|128;for(var A="",E=0;E<n;++E){var D=y[E];(E===4||E===6||E===8)&&(A+="-"),D<16&&(A+="0"),A+=D.toString(16).toLowerCase()}return A}}function ae(n){return n.__=void 0,delete n.__,n}})}(i||(i={})),Te}let j;function Z(i){if(typeof i!="function")throw new Error("This module should not be used in runtime. Instead, use a transformer during compilation.")}const fe=Symbol("assertions");function ct(i,e){let t=e;for(const r of i.slice(1))t=t[r.startsWith("[")?parseInt(r.replace("[","").replace("]","")):r];return t}function dt(i,e,t){if(i===void 0)return"validation error";const r=ct(e,t);try{return i+", found: "+require("util").inspect(r)}catch{}try{return i+", found: "+JSON.stringify(r)}catch{}return i}class he extends Error{constructor(e,t){super(dt(e.message,e.path,t)),this.name="TypeGuardError",this.path=e.path,this.reason=e.reason,this.input=t}}function ht(i,e={}){return Ge(),function(t,r,s){const u=Reflect.getOwnMetadata(fe,t,r)||[];Reflect.getOwnMetadata("design:returntype",t,r)===Promise?u[s]={assertion:i,options:Object.assign({async:!0},e)}:u[s]={assertion:i,options:e},Reflect.defineMetadata(fe,u,t,r)}}function pt(i=he){return Ge(),function(e){for(const t of Object.getOwnPropertyNames(e.prototype)){const r=Reflect.getOwnMetadata(fe,e.prototype,t);if(r){const s=e.prototype[t];e.prototype[t]=function(...u){for(let a=0;a<r.length;a++){if(!r[a])continue;const d=r[a].assertion(u[a]);if(d!==null){const m=new i(d,u[a]);if(r[a].options.async)return Promise.reject(m);throw m}}return s.apply(this,u)}}}}}function le(i,e=j){return Z(e),e(i)===null}function ce(i,e=j){Z(e);const t=e(i);if(t===null)return i;throw new he(t,i)}function ke(i=j){return Z(i),e=>le(e,i)}function Ie(i=j){return Z(i),e=>ce(e,i)}function _t(i){j=i}var G={is:le,assertType:ce,createIs:ke,createAssertType:Ie,equals:le,createEquals:ke,assertEquals:ce,createAssertEquals:Ie,AssertType:ht,ValidateClass:pt,TypeGuardError:he,setDefaultGetErrorObject:_t};function vt(i){return class extends i{constructor(...t){super(...t),this.namespaces={arweaveWallet:{walletName:"ArConnect",connect:()=>this.address||this.connect(),disconnect:()=>this.disconnect(),getActiveAddress:()=>this.address,getActivePublicKey:()=>this.getPublicKey(),getAllAddresses:()=>{throw"not implemented"},getWalletNames:()=>{throw"not implemented"},signature:()=>{throw"deprecated, do not use"},sign:(r,s)=>this.signTransaction(r,s),dispatch:(r,s)=>this.dispatch(r,s),encrypt:(r,s)=>R(this,void 0,void 0,function*(){const u=yield this.getPublicKey();return this.encrypt(r,u,s)}),decrypt:(r,s)=>this.decrypt(r,s),getPermissions:()=>["ACCESS_ADDRESS","ACCESS_PUBLIC_KEY","ACCESS_ALL_ADDRESSES","SIGN_TRANSACTION","ENCRYPT","DECRYPT","SIGNATURE","ACCESS_ARWEAVE_CONFIG","DISPATCH"],getArweaveConfig:()=>this.getArweaveConfig()}}}postMessage(t,r,s){return super.postMessage(t,r,Object.assign(Object.assign({},s),{protocol:"arweave",version:"1.0.0"}))}getPublicKey(){return R(this,void 0,void 0,function*(){const t=yield this.postMessage("getPublicKey");if(!G.is(t,r=>{function s(u){return typeof u!="string"?{}:null}return s(r)}))throw"TypeError";return t})}getArweaveConfig(){return R(this,void 0,void 0,function*(){const t=yield this.postMessage("getArweaveConfig");if(!G.is(t,r=>{function s(l){return l!==void 0?{}:null}function u(l){return typeof l!="string"?{}:null}function a(l){var p=[s,u];for(const k of p){var I=k(l);if(!I)return null}return{}}function d(l){return typeof l!="number"?{}:null}function m(l){var p=[s,u,d];for(const k of p){var I=k(l);if(!I)return null}return{}}function M(l){var p=[s,d];for(const k of p){var I=k(l);if(!I)return null}return{}}function S(l){return l!==!1?{}:null}function P(l){return l!==!0?{}:null}function _(l){var p=[s,S,P];for(const k of p){var I=k(l);if(!I)return null}return{}}function g(l){if(typeof l!="object"||l===null||Array.isArray(l))return{};if("host"in l){var p=a(l.host);if(p)return p}if("protocol"in l){var p=a(l.protocol);if(p)return p}if("port"in l){var p=m(l.port);if(p)return p}if("timeout"in l){var p=M(l.timeout);if(p)return p}if("logging"in l){var p=_(l.logging);if(p)return p}if("network"in l){var p=a(l.network);if(p)return p}return null}function T(){return null}function O(l){if(typeof l!="object"||l===null||Array.isArray(l))return{};if("logger"in l){var p=T(l.logger);if(p)return p}return null}function h(l){var p=[g,O];for(const k of p){var I=k(l);if(I)return I}return null}return h(r)}))throw"TypeError";return delete t.logger,t})}signTransaction(t,r){var s;return R(this,void 0,void 0,function*(){const u=st(t,["data","chunks"]),a=yield this.postMessage("signTransaction",[u,r]);if(!G.is(a,d=>{function m(h){return typeof h!="string"?{}:null}function M(h){return h!==void 0?{}:null}function S(h){return h!==null?{}:null}function P(h){var l=[M,S,m];for(const I of l){var p=I(h);if(!p)return null}return{}}function _(h){if(typeof h!="object"||h===null||Array.isArray(h))return{};if("name"in h){var l=m(h.name);if(l)return l}else return{};if("value"in h){var l=m(h.value);if(l)return l}else return{};return null}function g(h){if(!Array.isArray(h))return{};for(let p=0;p<h.length;p++){var l=_(h[p]);if(l)return l}return null}function T(h){var l=[M,S,g];for(const I of l){var p=I(h);if(!p)return null}return{}}function O(h){if(typeof h!="object"||h===null||Array.isArray(h))return{};if("id"in h){var l=m(h.id);if(l)return l}else return{};if("owner"in h){var l=P(h.owner);if(l)return l}if("tags"in h){var l=T(h.tags);if(l)return l}if("signature"in h){var l=m(h.signature);if(l)return l}else return{};if("reward"in h){var l=P(h.reward);if(l)return l}return null}return O(d)}))throw"TypeError";return t.setSignature({id:a.id,owner:a.owner||t.owner,tags:(s=a.tags)===null||s===void 0?void 0:s.map(d=>new lt(d.name,d.value,!0)),signature:a.signature,reward:a.reward||void 0}),t})}signDataItem(t){return R(this,void 0,void 0,function*(){const r=yield this.postMessage("signDataItem",[t]);if(!ArrayBuffer.isView(r))throw"TypeError";return r.buffer})}dispatch(t,r){return R(this,void 0,void 0,function*(){const s=yield this.postMessage("dispatch",[t,r],{transfer:!0});if(!G.is(s,u=>{function a(P){return typeof P!="string"?{}:null}function d(P){return P!=="BASE"?{}:null}function m(P){return P!=="BUNDLED"?{}:null}function M(P){var _=[d,m];for(const T of _){var g=T(P);if(!g)return null}return{}}function S(P){if(typeof P!="object"||P===null||Array.isArray(P))return{};if("id"in P){var _=a(P.id);if(_)return _}if("type"in P){var _=M(P.type);if(_)return _}return null}return S(u)}))throw"TypeError";return s})}signMessage(t,r){return R(this,void 0,void 0,function*(){const s=yield this.postMessage("signMessage",[t,r]);if(!ArrayBuffer.isView(s))throw"TypeError";const u=t.constructor;return new u(s.buffer)})}verifyMessage(t,r,s,u){return R(this,void 0,void 0,function*(){r=typeof r=="string"?J.b64UrlToBuffer(r):r;const a=yield this.postMessage("verifyMessage",[t,r,s,u]);if(!G.is(a,d=>{function m(M){return typeof M!="boolean"?{}:null}return m(d)}))throw"TypeError";return a})}encrypt(t,r,s){return R(this,void 0,void 0,function*(){const u=yield this.postMessage("encrypt",[t,r,s]);if(!ArrayBuffer.isView(u))throw"TypeError";const a=t.constructor;return new a(u.buffer)})}decrypt(t,r){return R(this,void 0,void 0,function*(){const s=yield this.postMessage("decrypt",[t,r]);if(!ArrayBuffer.isView(s))throw"TypeError";const u=t.constructor;return new u(s.buffer)})}privateHash(t,r){return R(this,void 0,void 0,function*(){const s=yield this.postMessage("privateHash",[t,r]);if(!ArrayBuffer.isView(s))throw"TypeError";const u=t.constructor;return new u(s.buffer)})}}}function yt(i){return{all:i=i||new Map,on:function(e,t){var r=i.get(e);r?r.push(t):i.set(e,[t])},off:function(e,t){var r=i.get(e);r&&(t?r.splice(r.indexOf(t)>>>0,1):i.set(e,[]))},emit:function(e,t){var r=i.get(e);r&&r.slice().map(function(s){s(t)}),(r=i.get("*"))&&r.slice().map(function(s){s(e,t)})}}}class He{constructor(){this.mittInstance=yt()}emit(e,t){this.mittInstance.emit(e,t)}on(e,t){this.mittInstance.on(e,t)}off(e,t){this.mittInstance.off(e,t)}once(e,t){return new Promise(r=>{const s=u=>{this.off(e,s),r(u),t&&t(u)};this.on(e,s)})}}class mt{constructor(){this._promiseController=[]}newMessagePromise(e,t){e.id=this._promiseController.length;const r=new Promise((s,u)=>this._promiseController.push({resolve:s,reject:u}));return t!=null&&t.timeout&&setTimeout(()=>this._promiseController[e.id].reject("timeout"),t.timeout),r}processResponse(e){const{id:t,result:r,error:s}=e;if(t!=null){if(typeof t!="number"&&typeof t!="string"||typeof t=="string"&&isNaN(parseInt(t)))throw"error";if(!this._promiseController[+t])throw"received result to nonexistent request";return s!=null?this._promiseController[+t].reject(s):this._promiseController[+t].resolve(r),!0}}}const Oe="400",xe="600";class wt extends He{constructor(e,t,r){if(super(),this._iframe={},this._showIframe=!1,this._popup={},this._usePopup=!0,this._requirePopup=!1,this._keepPopup=!1,this._promiseController=new mt,this._pending=[],this.listener=s=>{var u,a,d,m,M,S;if(s.source!==this._popup.window&&s.source!==((u=this._iframe)===null||u===void 0?void 0:u.window)||s.origin!==((a=this._url)===null||a===void 0?void 0:a.origin)||typeof s.data!="object")return;const{method:P,params:_,id:g,result:T,error:O,session:h}=s.data;if(console.info(`WalletConnector:${s.source===this._popup.window?"popup":"iframe"}`,s.data),g!=null&&(this._pending=this._pending.filter(p=>p!=g)),this._promiseController.processResponse(s.data)||typeof P!="string")return;if(P==="ready"){s.source===this._popup.window&&((m=(d=this._popup).resolve)===null||m===void 0||m.call(d)),s.source===this._iframe.window&&((S=(M=this._iframe).resolve)===null||S===void 0||S.call(M));return}if(P==="change")return;if(P==="showIframe"){if(typeof _!="boolean")return;this.showIframe=_}if(P==="usePopup"){if(typeof _!="boolean")return;this.setUsePopup(_)}if(P==="keepPopup"){if(typeof _!="boolean")return;this.setRequirePopup(_)}const l={method:P,params:_,session:h};if(!G.is(l,p=>{function I(x){return typeof x!="string"?{}:null}function k(){return null}function ee(x){return x!==void 0?{}:null}function te(x){return typeof x!="number"?{}:null}function re(x){var F=[ee,I,te];for(const se of F){var ie=se(x);if(!ie)return null}return{}}function ne(x){if(typeof x!="object"||x===null||Array.isArray(x))return{};if("method"in x){var F=I(x.method);if(F)return F}else return{};if("params"in x){var F=k(x.params);if(F)return F}else return{};if("session"in x){var F=re(x.session);if(F)return F}return null}return ne(p)}))return console.warn("dropped");this.emit("message",l)},this._iframeParentNode=t==null?void 0:t.iframeParentNode,this._url=e,typeof window<"u"){const s={origin:window.location.origin,session:Math.random().toString().slice(2)};t!=null&&t.name&&(s.name=t.name),t!=null&&t.logo&&(s.logo=t.logo),this._url.hash=new URLSearchParams(s).toString(),window.addEventListener("message",this.listener),r&&this.openIframe()}}get url(){var e;return(e=this._url)===null||e===void 0?void 0:e.origin}get showIframe(){return this._showIframe}set showIframe(e){e!==this._showIframe&&(this._showIframe=e,this.deliverMessage({method:"showIframe",params:e}),this.emit("builtin",{showIframe:e}),this._iframeNode&&(this._iframeParentNode||(this._iframeNode.style.opacity=e?"1":"0",this._iframeNode.style.pointerEvents=e?"":"none",this._iframeNode.style.touchAction=e?"":"none",this._iframeNode.style.zIndex=e?"1000000":"-1000000",this._iframeNode.style.transform=e?"":"translate(0, 24px)",this._iframeNode.style.transition=e?"opacity 0.36s cubic-bezier(0.22, 1, 0.36, 1), transform 0.36s cubic-bezier(0.22, 1, 0.36, 1)":"opacity 0.1s ease, transform 0.1s ease, z-index 0s linear 0.1s")))}get usePopup(){return this._usePopup}setUsePopup(e){e!==this._usePopup&&(this._usePopup=e,this.emit("builtin",{usePopup:e}))}get requirePopup(){return this._requirePopup}setRequirePopup(e){e!==this._requirePopup&&(this._requirePopup=e,this.emit("builtin",{requirePopup:e}))}get keepPopup(){return this._keepPopup}set keepPopup(e){this._keepPopup=e,this.emit("builtin",{keepPopup:e}),e||this.closePopup(),e&&this.openPopup(!0)}destructor(e){this.closeIframe(),this.closePopup(!0),window.removeEventListener("message",this.listener)}postMessage(e,t){const r=this._promiseController.newMessagePromise(e,t).finally(()=>this.completeRequest());return this.deliverMessage(e),r}openIframe(){var e;if(this._iframeEl)return;const t=new Promise((s,u)=>this._iframe={resolve:s,reject:u});this._iframe.promise=t;const r=Array.from(document.querySelectorAll("iframe")).find(s=>{try{return new URL(s.src).origin===this.url}catch{}});if(r)this._iframeEl=r,this._iframe.window=this._iframeEl.contentWindow,this.postMessage({method:"ready"});else{this._iframeNode=(e=this._iframeParentNode)!==null&&e!==void 0?e:document.createElement("div"),this._iframeEl=document.createElement("iframe"),this._iframeEl.src=this._url.toString(),this._iframeEl.allow="usb; hid; bluetooth; serial; camera; payment; web-share",this._iframeEl.setAttribute("allowTransparency","true"),this._iframeEl.style.border="none",this._iframeParentNode?(this._iframeEl.style.backgroundColor="transparent",this._iframeEl.style.width="100%",this._iframeEl.style.height="100%"):(this._iframeEl.width=Oe,this._iframeEl.height=xe,this._iframeEl.style.borderRadius="8px",this._iframeEl.style.maxWidth="100%",this._iframeEl.style.maxHeight="100%",this._iframeNode.style.position="fixed",this._iframeNode.style.inset="0",this._iframeNode.style.display="flex",this._iframeNode.style.alignItems="center",this._iframeNode.style.justifyContent="center",this._iframeNode.style.background="#00000088",this._iframeNode.style.opacity="0",this._iframeNode.style.pointerEvents="none",this._iframeNode.style.touchAction="none",this._iframeNode.style.zIndex="-1000000",this._iframeNode.style.transform="translate(0, 24px)",this._iframeNode.style.transition="opacity 0.1s ease, transform 0.1s ease, z-index 0s linear 0.1s"),this._iframeNode.appendChild(this._iframeEl);const s=()=>{var u;this._iframeParentNode||document.body.appendChild(this._iframeNode),this._iframe.window=(u=this._iframeEl)===null||u===void 0?void 0:u.contentWindow};document.readyState==="complete"||document.readyState==="interactive"?s():document.addEventListener("DOMContentLoaded",s)}}closeIframe(){var e,t,r,s,u;(e=this._iframeEl)===null||e===void 0||e.setAttribute("src","about:blank"),(t=this._iframeEl)===null||t===void 0||t.remove(),(r=this._iframeNode)===null||r===void 0||r.remove(),this._iframeNode=void 0,this._iframeEl=void 0,(u=(s=this._iframe).reject)===null||u===void 0||u.call(s),this._iframe={}}openPopup(e){if(this._popup.window&&!this._popup.window.closed){this._popup.window.focus();return}if(!this.usePopup&&!e)return;window.name="parent";const t=window.open(this._url.toString(),"_blank",`location,resizable,scrollbars,width=${Oe},height=${xe}`),r=new Promise((u,a)=>this._popup={window:t,resolve:u,reject:a});this._popup.promise=r;const s=setInterval(()=>{this._popup.window&&!this._popup.window.closed||(this.keepPopup&&(this.keepPopup=!1),clearInterval(s))},200)}closePopup(e){var t,r,s;if(!this._popup.window||!((t=this._popup.window)===null||t===void 0)&&t.closed||(this.keepPopup||this.requirePopup)&&!e)return;const u=this._popup.window;u.close(),u.location.href="about:blank";let a=0;const d=setInterval(()=>{a>50||!u||u.closed?clearInterval(d):a++,u.close()},100);(s=(r=this._popup).reject)===null||s===void 0||s.call(r),this._popup={}}completeRequest(){setTimeout(()=>{this._pending.length||(this.closePopup(),this.showIframe=!1)},100)}deliverMessage(e,t){var r,s;if(!this._url)throw"Missing URL";console.info("WalletConnector:post",e);const u=Object.assign(Object.assign({},e),{jsonrpc:"2.0"});u.id!=null&&this._pending.push(u.id),this.openIframe(),this._iframe.promise=(r=this._iframe.promise)===null||r===void 0?void 0:r.then(()=>{var a;return(a=this._iframe.window)===null||a===void 0?void 0:a.postMessage(u,this._url.origin,t!=null&&t.transfer?[u]:void 0)}).catch(()=>{}),this.openPopup(),this._popup.promise=(s=this._popup.promise)===null||s===void 0?void 0:s.then(()=>{var a;return(a=this._popup.window)===null||a===void 0?void 0:a.postMessage(u,this._url.origin,t!=null&&t.transfer?[u]:void 0)}).catch(()=>{})}}function Ce(i){return typeof i=="object"?i:(i.includes("://")||(i="https://"+i),new URL(i))}let Ue;const V=[],Q={},de={};function gt(i){i.namespaces&&(V.find(e=>e===i)||V.push(i),X())}function bt(i){if(!V.find(e=>e===i))return X();V.splice(V.indexOf(i),1);for(const e in i.namespaces)Q[e]===i&&(window[e]=de[e],delete de[e],delete Q[e]);X()}function X(){for(const i of V)for(const e in i.namespaces)Q[e]&&Q[e]!==i||window[e]!==i.namespaces[e]&&(de[e]=window[e],window[e]=i.namespaces[e],Q[e]=i);window.clearInterval(Ue),V.length&&(Ue=setInterval(()=>X(),1e4))}const Pt="Window context missing. If you are using a server side rendering framework, make sure that the connector is excluded. If you want to use the connector outside the browser, use the node version of the module instead";class L extends He{constructor(e,t){super(),this._session=0,this._listener=r=>{const{method:s,params:u,session:a}=r;if(!(a!=null&&this._session!=a)&&!(!a&&this._session)){if(s==="connect"){if(!G.is(u,d=>{function m(M){return typeof M!="string"?{}:null}return m(d)}))return;this.setAddress(u)}s==="disconnect"&&this.disconnectEvent(!1)}},this._appInfo=e,this._emitterPassthrough=r=>{const s=Object.entries(r)[0];this.emit(s[0],s[1])},this.on("connect",()=>gt(this)),this.on("disconnect",()=>bt(this)),t&&(this._url=Ce(t))}get address(){return this._address}setAddress(e){e&&e===this.address||(this._address=e,e!=null?this.emit("connect",e):this.emit("disconnect",e),this.emit("change",e))}get connected(){return this._address!=null}get url(){var e;return(e=this._bridge)===null||e===void 0?void 0:e.url}get showIframe(){var e;return((e=this._bridge)===null||e===void 0?void 0:e.showIframe)||!1}get usePopup(){var e;return((e=this._bridge)===null||e===void 0?void 0:e.usePopup)||!1}get requirePopup(){var e;return((e=this._bridge)===null||e===void 0?void 0:e.requirePopup)||!1}get keepPopup(){var e;return((e=this._bridge)===null||e===void 0?void 0:e.keepPopup)||!1}set keepPopup(e){this._bridge&&(this._bridge.keepPopup=e)}setUrl(e,t){var r;if(typeof window>"u"){console.error(Pt);return}const s=this._bridge,u=Ce(e);if(this._url=u,((r=this._bridge)===null||r===void 0?void 0:r.url)!==u.origin){if(this.disconnect(),!L._bridges[u.origin])this._bridge=new wt(u,this._appInfo,t),L._bridges[u.origin]={bridge:this._bridge,sessions:[]};else{this._bridge=L._bridges[u.origin].bridge;const a=L._bridges[u.origin].sessions;for(let d=0;d<=a.length;d++)if(a.indexOf(d)<0){this._session=d;break}}L._bridges[u.origin].sessions.push(this._session),this._bridge.on("message",this._listener),this._bridge.on("builtin",this._emitterPassthrough),this._bridge.showIframe!==(s==null?void 0:s.showIframe)&&this.emit("showIframe",this._bridge.showIframe),this._bridge.usePopup!==(s==null?void 0:s.usePopup)&&this.emit("usePopup",this._bridge.usePopup),this._bridge.requirePopup!==(s==null?void 0:s.requirePopup)&&this.emit("requirePopup",this._bridge.requirePopup),this._bridge.keepPopup!==(s==null?void 0:s.keepPopup)&&this.emit("keepPopup",this._bridge.keepPopup)}}connect(e){return R(this,void 0,void 0,function*(){if(!this._url)throw"Connect failed: URL missing";this._bridge||this.setUrl(this._url);const t=new Promise((r,s)=>{this.once("change",u=>u?r(u):s())}).finally(()=>{var r;return(r=this._bridge)===null||r===void 0?void 0:r.completeRequest()});return this._bridge.deliverMessage({method:"connect",params:e}),t})}disconnect(e){return R(this,void 0,void 0,function*(){return this.disconnectEvent(!0,e)})}disconnectEvent(e,t){return R(this,void 0,void 0,function*(){if(!this._bridge)return;const r=this._bridge,s=this._session,u=r.url;if(this.setAddress(void 0),this._bridge=void 0,this._session=0,e)try{yield r.postMessage({method:"disconnect",params:[t],session:s},{timeout:5e3})}catch{console.warn("disconnect request failed")}r.off("message",this._listener),r.off("builtin",this._emitterPassthrough),L._bridges[u].sessions=L._bridges[u].sessions.filter(a=>a!=s),setTimeout(()=>{L._bridges[u].sessions.length||(L._bridges[u].bridge.destructor(),delete L._bridges[u])},100)})}postMessage(e,t,r){return new Promise((s,u)=>{if(!this._url)throw"Post message failed: URL missing";if(!this._bridge)throw"Post message failed: URL not loaded, call setUrl or connect first";this.once("disconnect",u),this._bridge.postMessage({method:e,params:t,session:this._session,protocol:r==null?void 0:r.protocol,version:r==null?void 0:r.version},r).then(s).catch(u)})}}L._bridges={};class H extends L{constructor(e,t){var r;if(super(e,(r=Ve(t==null?void 0:t.state))===null||r===void 0?void 0:r.url),this._subs=[],this._localStorageKey="arweave-wallet-connector:URL",this.setUrl=(a,d)=>{super.setUrl(a,d),this.updateState({url:super.url})},this.subscribe=a=>(this._subs.push(a),a(this._state.value),()=>this._subs.filter(d=>d!==a)),this.setState=a=>{var d;const m=(d=H._instance)!==null&&d!==void 0?d:this;a&&Array.isArray(a)&&(m._setState=a[1]),a&&"set"in a&&(m._setState=a.set);const M=At(a);return m._state=M.state,Object.keys(M.newProps).length&&m.updateState(M.newProps),a},this.updateState=a=>{a&&(Object.assign(this._state.value,a),this._setState&&this._setState(Object.assign({},this._state.value)),this._subs.forEach(d=>d(this._state.value)))},this.setState(t==null?void 0:t.state),H._instance)return H._instance;H._instance=new Proxy(this,{get:(a,d,m)=>d in a._state.value?a._state.value[d]:a[d],set:(a,d,m,M)=>(d==="keepPopup"?super.keepPopup=m:a[d]=m,!0)});let s=!1;if(this.on("connect",a=>{const d=super.url;this.updateState({address:a,url:d,connected:!0}),this._localStorageKey&&localStorage.setItem(this._localStorageKey,d??"")}),this.on("disconnect",()=>{this.updateState({address:void 0,connected:!1}),this._localStorageKey&&!s&&localStorage.removeItem(this._localStorageKey)}),["showIframe","usePopup","requirePopup","keepPopup"].forEach(a=>this.on(a,d=>this.updateState({[a]:d}))),typeof window<"u"&&(window.addEventListener("beforeunload",()=>s=!0),window.addEventListener("unload",()=>s=!0),(t==null?void 0:t.localStorageKey)!=null&&(this._localStorageKey=t.localStorageKey),this._localStorageKey)){const a=localStorage.getItem(this._localStorageKey);a&&this.setUrl(a,!0),localStorage.removeItem(this._localStorageKey)}return H._instance}}function Ve(i){if(i){if("subscribe"in i){let e;const t=i.subscribe(r=>e=r);return t==null||t(),e}return Array.isArray(i)?i[0]:"value"in i?i.value:i}}function At(i){let e;return i?Array.isArray(i)?e=$({value:i[0]}):"value"in i?e=$(i):"subscribe"in i?e=$({value:Ve(i)}):e=$({value:i}):e=$({value:{}}),e}function $(i){var e;(e=i.value)!==null&&e!==void 0||(i.value={});const t=Et(i.value);return{state:i,newProps:t.newProps}}function Et(i={}){const e={url:void 0,address:void 0,connected:!1,showIframe:!1,usePopup:!1,requirePopup:!1,keepPopup:!1},t={};for(const r in e)i[r]==null&&(t[r]=e[r],i[r]=e[r]);return{state:i,newProps:t}}const Ne=vt(H);var Mt=Object.defineProperty,Tt=(i,e,t)=>e in i?Mt(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,B=(i,e,t)=>(Tt(i,typeof e!="symbol"?e+"":e,t),t);const W={name:"Arweave.app",description:"Web based wallet software",theme:"24, 24, 24",logo:"qVms-k8Ox-eKFJN5QFvrPQvT9ryqQXaFcYbr-fJbgLY",url:"arweave.app",customInterfaceURL:"https://arweave.app"};class It extends it{constructor(e){super(),B(this,"id","webwallet"),B(this,"name",W.name),B(this,"description",W.description),B(this,"theme",W.theme),B(this,"logo",W.logo),B(this,"url",W.customInterfaceURL),B(this,"instance",new Ne),B(this,"instanceURL",W.url),e&&(this.name=e.name,this.description=e.description,this.theme=e.theme||W.theme,this.logo=e.logo||W.logo,this.instanceURL=e.url,this.url=e.customInterfaceURL||"http://"+e.url),this.instance.setUrl(this.instanceURL),this.instanceURL!==W.url&&(this.id=this.id+this.instanceURL)}async isAvailable(){return!0}async resumeSession(){this.instance.setUrl(this.instanceURL),await this.instance.connect()}async connect(e,t,r){r&&console.warn("[Arweave Wallet Kit] The WebWallets API does not support custom gateway connection yet."),this.instance=new Ne(t),await this.resumeSession()}addAddressEvent(e){return this.instance.on("connect",e),e}removeAddressEvent(e){this.instance.off("connect",e)}}export{It as default};

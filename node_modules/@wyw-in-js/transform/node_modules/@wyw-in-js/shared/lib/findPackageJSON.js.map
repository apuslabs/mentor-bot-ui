{"version":3,"file":"findPackageJSON.js","names":["_path","require","process","_interopRequireWildcard","_findUp","_interopRequireDefault","obj","__esModule","default","_getRequireWildcardCache","e","WeakMap","r","t","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","prototype","hasOwnProperty","call","i","set","cache","Map","findPackageJSON","pkgName","filename","isJest","Boolean","env","JEST_WORKER_ID","skipPathsOptions","startsWith","pkgPath","isAbsolute","resolve","paths","dirname","findUp","sync","cwd","er","code","undefined"],"sources":["../src/findPackageJSON.ts"],"sourcesContent":["import { dirname, isAbsolute } from 'path';\nimport * as process from 'process';\n\nimport findUp from 'find-up';\n\nconst cache = new Map<string, string | undefined>();\n\nexport function findPackageJSON(\n  pkgName: string,\n  filename: string | null | undefined\n) {\n  // Jest's resolver does not work properly with `moduleNameMapper` when `paths` are defined\n  const isJest = Boolean(process.env.JEST_WORKER_ID);\n  const skipPathsOptions = isJest && !pkgName.startsWith('.');\n\n  try {\n    const pkgPath =\n      pkgName === '.' && filename && isAbsolute(filename)\n        ? filename\n        : require.resolve(\n            pkgName,\n            filename ? { paths: [dirname(filename)] } : {}\n          );\n    if (!cache.has(pkgPath)) {\n      cache.set(pkgPath, findUp.sync('package.json', { cwd: pkgPath }));\n    }\n\n    return cache.get(pkgPath);\n  } catch (er: unknown) {\n    const code =\n      typeof er === 'object' && er !== null && 'code' in er\n        ? er.code\n        : undefined;\n\n    if (code === 'MODULE_NOT_FOUND') {\n      if (skipPathsOptions && filename) {\n        return findPackageJSON(pkgName, null);\n      }\n\n      return undefined;\n    }\n\n    if (code === 'ERR_PACKAGE_PATH_NOT_EXPORTED') {\n      // See https://github.com/Anber/wyw-in-js/issues/43\n      // `require` can't resolve ESM-only packages. We can use the `resolve`\n      // package here, but it does not solve all cases because `pkgName`\n      // can be an alias and should be resolved by a bundler. However, we can't use\n      // `resolve` from a bundler because it is async. The good news is that in that\n      // specific case, we can just ignore those packages. For now.\n      return undefined;\n    }\n\n    throw er;\n  }\n}\n"],"mappings":"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"}